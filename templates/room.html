{% extends 'base.html' %}
{% block content %}
<div class="activity-board">
  <!-- Timer Display -->
  <div class="timer-container">
    <svg class="countdown-svg" width="80" height="80" viewBox="0 0 100 100">
      <circle class="countdown-circle-bg" cx="50" cy="50" r="45"></circle>
      <circle class="countdown-circle" cx="50" cy="50" r="45"></circle>
      <text id="timer-text" x="50" y="55" text-anchor="middle" font-size="20px" fill="#fff"
        transform="rotate(90, 50, 50)">
        60
      </text>
    </svg>
  </div>
  

  <h2>Enter an activity you would like to have at your next hangout</h2>
  <div class="responses" id="responses">
    {% for msg in messages %}
    <div class="response-bubble">
      <strong>{{ msg.name }}:</strong> {{ msg.message }}
    </div>
    {% endfor %}
  </div>
  <div class="inputs">
    <input
      type="text"
      placeholder="Enter your option..."
      name="activity"
      id="activity"
    />
    <button type="button" name="send" id="send-btn" onClick="sendMessage()">Submit</button>
  </div>
</div>

<script type="text/javascript">
  var socketio = io();

  const responses = document.getElementById("responses");

  const createResponse = (name, msg) => {
    const content = `
    <div class="response-bubble">
        <strong>${name}:</strong> ${msg}
    </div>
    `;
    responses.innerHTML += content;
    // Ensure the response bubbles are always in view
    responses.scrollTop = responses.scrollHeight;
  };

  socketio.on("response", (data) => {
    createResponse(data.name, data.message);
  });

  const sendMessage = () => {
    const activity = document.getElementById("activity");
    if (activity.value == "") return;
    socketio.emit("response", { data: activity.value });
    createResponse("You", activity.value); // Display the current user's input immediately
    activity.value = "";
  };
</script>

<!-- Import External Timer Script -->
<script src="{{ url_for('static', filename='js/timer.js') }}"></script>
<script type="text/javascript">
    var socketio = io();

    // Listen for the redirect event from the server
    socketio.on("redirect_to_vote", function () {
        console.log("Redirecting to /game");  // Debugging log
        window.location.href = "/game";  // Redirect to the game page
    });
</script>

{% endblock %}

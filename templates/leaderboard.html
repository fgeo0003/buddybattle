{% extends 'base.html' %}
{% block content %}
<div class="leaderboard-container">
    <h2 class="heading">Leaderboard</h2>
    <ul class="leaderboard-list">
        {% for player, score in scores.items() | sort(attribute='1', reverse=True) %}
        <li class="{% if loop.first %}top-player{% endif %}">
            <strong>{{ player }}</strong>: {{ score }} coins
        </li>
        {% endfor %}
    </ul>

    <!-- Display elimination message -->
    <div id="elimination-message" class="elimination-message">
        {% if elimination_message %}
        <p>{{ elimination_message }}</p>
        {% endif %}
    </div>

    {% if is_winner %}
    <div class="eliminate-idea">
        <h3 class="congratulations">Congratulations âœ¨</h3>
        <h4 class="eliminate-text">Eliminate an idea:</h4>
        <ul>
            {% for message in rooms[room]["messages"] %}
            <li>
                {{ message.message }} 
                <!-- (submitted by {{ message.name }}) -->
                <button onclick="eliminateIdea({{ loop.index0 }})">Eliminate</button>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% else %}
    <p>Waiting for the winner to eliminate an idea...</p>
    {% endif %}
</div>

<script type="text/javascript">
    var socketio = io();

    function eliminateIdea(index) {
        socketio.emit("eliminate_idea", { idea_index: index });
    }

    // Handle the elimination message
    socketio.on("idea_eliminated", (data) => {
        const eliminationMessage = document.getElementById("elimination-message");
        eliminationMessage.innerHTML = `<p>The idea "${data.eliminated_idea}" has been eliminated by ${data.winning_player}.</p>`;
    });
</script>
{% endblock %}